local icons = {
  lua = "Û∞¢±",
  py  = "ÓòÜ",
  js  = "Û∞åû",
  ts  = "Û∞õ¶",
  html= "Û∞åù",
  css = "Û∞åú",
  md  = "Û∞çî",
  json= "Û∞ò¶",
  lock= "Û∞åæ",
  nvimtree= "Û∞ôÖ",
  default = "ÔÉ∂",
}

require("nvim-tree").setup({
  git = {
    enable = true,
  },
  renderer = {
    icons = {
      webdev_colors = true,
      show = {
        file = true,
        folder = true,
        folder_arrow = true,
        git = true,
      },
    },
  },
})

local function get_icon(filename, bufnr)
  local ft = vim.api.nvim_buf_get_option(bufnr, "filetype")

  if ft == "NvimTree" then
    return icons.nvimtree
  end

  local ext = filename:match("^.+%.(.+)$")
  return icons[ext] or icons.default
end

-- Fun√ß√£o que renderiza o tabline
function _G.my_tabline()
  local buffers = vim.api.nvim_list_bufs()
  local current = vim.api.nvim_get_current_buf()

  -- Filtra apenas buffers v√°lidos (nome != "", carregados, n√£o NvimTree)
  local real_buffers = {}
  local has_nvimtree = false

  for _, buf in ipairs(buffers) do
    if vim.api.nvim_buf_is_loaded(buf) then
      local ft = vim.api.nvim_buf_get_option(buf, "filetype")
      local name = vim.api.nvim_buf_get_name(buf)

      if ft == "NvimTree" then
        has_nvimtree = true
      elseif name ~= "" then
        table.insert(real_buffers, buf)
      end
    end
  end

  -- üîπ Caso especial: s√≥ 1 buffer normal e nenhum NvimTree ‚Üí tabline minimalista
  if #real_buffers <= 1 and not has_nvimtree then
    return "%#TabLineFill# "  -- ‚Üê tabline vazio estilizado
  end

  -- üîπ Caso: NvimTree aberto OU mais de 1 buffer ‚Üí tabline com √≠cones
  local s = ""

  for _, buf in ipairs(buffers) do
    if vim.api.nvim_buf_is_loaded(buf) then
      local ft = vim.api.nvim_buf_get_option(buf, "filetype")
      local name = vim.fn.fnamemodify(vim.api.nvim_buf_get_name(buf), ":t")

      local icon
      if ft == "NvimTree" then
        icon = icons.nvimtree or "Û∞ôÖ"
        name = "NvimTree"
      else
        icon = get_icon(name, buf)
      end

      if name ~= "" then
        if buf == current then
          s = s .. "%#TabLineSel# " .. icon .. " " .. name .. " %*"
        else
          s = s .. "%#TabLine# " .. icon .. " " .. name .. " %*"
        end
      end
    end
  end

  return s .. "%#TabLineFill#"
end

vim.opt.tabline = "%!v:lua.my_tabline()"

